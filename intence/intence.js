!function(t,e){"function"==typeof define&&define.amd?define(["exports"],e):e("undefined"!=typeof exports?exports:t.intence={})}(this,function(t){var e={textureMaxSqueeze:1e3,indicatorMaxArea:.12,indicatorGain:1/4500,animationTime:160,animationDelay:20};e.blocksNumber=1+Math.ceil(Math.log(e.textureMaxSqueeze)/Math.log(4));var i="intence-unique-"+(new Date).getTime(),s={div:document.createElement("div"),img:document.createElement("img"),canvas:document.createElement("canvas"),object:document.createElement("object"),style:document.createElement("style")},n=function(t,e,i){for(var n,a=t;-1!=(n=a.indexOf("-"));)a=a.slice(0,n)+a.slice(n+1,n+2).toUpperCase()+a.slice(n+2);var o=s.div.cloneNode(!1),r=t+": "+e;return i&&(r+="("+i+")"),o.style.cssText=r,a in document.documentElement.style&&"-1"!=o.style[a].indexOf(e)},a=navigator.userAgent,o="undefined"!=typeof InstallTrigger,r=!1||!!document.documentMode,h=Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0,l=!!window.chrome,c={classList:!!s.div.classList,event:!!window.addEventListener,canvas:!!s.canvas.getContext,isolation:n("isolation","isolate"),opacity:n("opacity",".5"),transform:n("transform","translate3d","0, 0, 0"),webkitTransform:n("-webkit-transform","rotate","-180deg"),backgroundCanvas:{webkit:!!document.getCSSCanvasContext&&n("background","-webkit-canvas","a"),mozElement:n("background","-moz-element","#a")},gradientMask:{alphaFilter:n("filter","progid:DXImageTransform.Microsoft.Alpha","opacity=100,finishOpacity=0,style=1,startX=0,finishX=1,startY=0,finishY=1"),webkit:n("-webkit-mask-image","-webkit-linear-gradient","top, rgba(0,0,0,1), rgba(0,0,0,0) 100%"),svgReuse:o}},d=r&&c.gradientMask.alphaFilter,u=!0,p={hasClass:c.classList?"classList":"className",async:c.event?"event":"setTimeout",stackingContext:null,blocks:c.webkitTransform?"webkitTransform":"div",mask:null,canvas:null,floatLeft:null};c.canvas?(c.gradientMask.webkit?(p.mask="webkit",p.canvas=c.backgroundCanvas.webkit?"webkit":"dataURL"):c.gradientMask.svgReuse?c.backgroundCanvas.mozElement?(p.canvas="mozElement",p.mask="svgReuse"):p.blocks="svg":c.gradientMask.alphaFilter?(p.canvas="dataURL",p.mask="alphaFilter",p.blocks="div"):p.blocks="svg",c.isolation?p.stackingContext="isolation":d||(c.transform?p.stackingContext="transform":c.opacity&&(p.stackingContext="opacity"))):u=!1,p.floatLeft=o&&+a.match(/Firefox\/(\d+)/)[1]<36?"stylesheet":"direct","svg"!=p.blocks||r||(u=!1);var _;(-1!=a.indexOf("Opera")||o&&(_=a.match(/Firefox\/(\d+)/))&&+_[1]<8||h&&(_=a.match(/Version\/(\d+)/))&&+_[1]<7||h&&(_=a.match(/CriOS\/(\d+)/))&&+_[1]<15||l&&(_=a.match(/Chrome\/(\d+)/))&&+_[1]<15)&&(u=!1);var m={},g=function(t,e){var i={north:"top",east:"right",south:"bottom",west:"left"};t.style.WebkitMaskImage="-webkit-linear-gradient("+i[e]+",rgba(0,0,0,1) 0%,rgba(0,0,0,.81) 10%,rgba(0,0,0,.64) 20%,rgba(0,0,0,.49) 30%,rgba(0,0,0,.36) 40%,rgba(0,0,0,.25) 50%,rgba(0,0,0,.16) 60%,rgba(0,0,0,.09) 70%,rgba(0,0,0,.04) 80%,rgba(0,0,0,.01) 90%,rgba(0,0,0,0)  100%)"},f=function(t,e){var i={x1:0,x2:0,y1:0,y2:0},s={north:"y2",east:"x1",south:"y1",west:"x2"};i[s[e]]="100";var n="progid:DXImageTransform.Microsoft.Alpha(opacity=100,finishOpacity=0,style=1,startX="+i.x1+",finishX="+i.x2+",startY="+i.y1+",finishY="+i.y2+")";t.style.filter=n},y={north:null,east:null,south:null,west:null},v=function(t,e){y[e]||(y[e]=b(e)),t.style.mask="url(#"+y[e]+")"},b=function(t){var e="svg-mask-"+t+"-"+i,s="mask-"+e,n="gradient-"+e,a=U.genSVGElement("svg"),o=U.genSVGElement("defs",a);U.genSVGLinearGradient(o,t,n);var r=U.genSVGElement("mask",o,{id:s,maskUnits:"objectBoundingBox",maskContentUnits:"objectBoundingBox"});return U.genSVGElement("rect",r,{y:"0",width:"1",height:"1",fill:"url(#"+n+")"}),U.setStyle(a,{position:"absolute",width:"0px",height:"0px"}),document.body.appendChild(a),s};switch(p.mask){case"svgReuse":m.gradientMask=v;break;case"webkit":m.gradientMask=g;break;case"alphaFilter":m.gradientMask=f}var k=function(t){t.style.isolation="isolate"},w=function(t){t.style.transform="translate3d(0,0,0)"},x=function(t){t.style.opacity=.9999999};switch(p.stackingContext){case"isolation":m.stackingContext=k;break;case"transform":m.stackingContext=w;break;case"opacity":m.stackingContext=x;break;default:m.stackingContext=function(){}}var S=function(t,e){t.style.backgroundImage="url("+U.getCanvasDataURL(e)[0]+")"},C=0,V=function(t,e){if("undefined"==typeof e.CSSContextId){var s="canvasCSSContext-"+C++ +"-"+i,n=document.getCSSCanvasContext("2d",s,e.width,e.height);n.drawImage(e,0,0),e.CSSContextId=s}t.style.background="-webkit-canvas("+e.CSSContextId+")"},G=0,I=function(t,e){if(!e.getAttribute("id")){var s="MozElement-"+G++ +"-"+i;e.setAttribute("id",s),U.setStyle(e,{position:"absolute",width:"0px",height:"0px"}),document.body.appendChild(e)}t.style.background="-moz-element(#"+e.getAttribute("id")+")"};switch(p.canvas){case"dataURL":m.backgroundCanvas=S;break;case"webkit":m.backgroundCanvas=V;break;case"mozElement":m.backgroundCanvas=I}var M=function(t,e,i){setTimeout(function(){t.apply(e||null,i||[])},0)},E=function(t,e,i){B.push([t,e||window,i]),window.postMessage(A,"*")},B=[],A="async-"+i,N=function(t){if(t.source==window&&t.data==A&&B.length>0){var e=B.shift();e[0].apply(e[1],e[2])}};"event"==p.async?(window.addEventListener("message",N,!0),m.async=E):m.async=M;var z=function(t,e){for(var i=!1,s=t.classList,n=0;n<s.length;n++)if(s[n]==e){i=!0;break}return i},T=function(t,e){for(var i=!1,s=t.className.split(" "),n=0;n<s.length;n++)if(s[n]==e){i=!0;break}return i};m.hasClass="classList"==p.hasClass?z:T;var D=function(t){t.style["float"]="left"},L=function(t){t.className=R()},O=null,R=function(){if(!O){var t="float-left-cls-"+i,e=document.getElementsByTagName("head")[0],n=s.style.cloneNode(!1);n.type="text/css",n.innerHTML="."+t+" { float:left; }",e.appendChild(n),O=t}return O};m.floatLeft="stylesheet"==p.floatLeft?L:D;var U={};U.dir=["north","east","south","west"],U.isVertical={north:!0,east:!1,south:!0,west:!1},U.ccv={north:"west",east:"north",south:"east",west:"south"},U.setStyle=function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t.style[i]=e[i])},U.setAttributes=function(t,e){for(var i in e)e.hasOwnProperty(i)&&t.setAttribute(i,e[i])},U.px=function(t){return""+t+"px"},U.detachChildren=function(t){for(var e=[];t.firstChild;)e.push(t.removeChild(t.firstChild));return e},U.attachChildren=function(t,e){for(var i=0;i<e.length;i++)t.appendChild(e[i])},U.getCanvasDataURL=function(t){return"undefined"==typeof t.intence_cached_dataURL&&(t.intence_cached_dataURL=[t.toDataURL()]),t.intence_cached_dataURL},U.genCanvas=function(t,e){var i=s.canvas.cloneNode(!1);return i.width=t,i.height=e,U.setStyle(i,{width:U.px(t),height:U.px(e),display:"none"}),i},U.img2canvas=function(t){var e=U.genCanvas(t.width||t.naturalWidth,t.height||t.naturalHeight),i=e.getContext("2d");return i.drawImage(t,0,0),e},U._svgNS="http://www.w3.org/2000/svg",U._xlinkNS="http://www.w3.org/1999/xlink",U.genSVGElement=function(t,e,i){var s=document.createElementNS(U._svgNS,t);if(i)for(var n in i)i.hasOwnProperty(n)&&(-1!=n.indexOf("xlink")?s.setAttributeNS(U._xlinkNS,n,i[n]):s.setAttribute(n,i[n]));return e&&e.appendChild(s),s},U._commonSVG=null,U.getCommonSVG=function(){return U._commonSVGDefs||(U._commonSVG=U.genSVGElement("svg",document.body),U.setStyle(U._commonSVG,{width:"0px",height:"0px",position:"absolute",display:"none"})),U._commonSVG},U._commonSVGDefs=null,U.getCommonSVGDefs=function(){return U._commonSVGDefs||(U._commonSVGDefs=U.genSVGElement("defs",U.getCommonSVG())),U._commonSVGDefs},U.genSVGLinearGradient=function(t,e,i){var s={x1:"0%",y1:"0%",x2:"0%",y2:"0%"};if(e){var n={north:"y2",east:"x1",south:"y1",west:"x2"};s[n[e]]="100%"}i&&(s.id=i);var a,o,r=U.genSVGElement("linearGradient",t,s);for(a=0;10>=a;a++)o=""+(10-a)*(10-a)+"%",U.genSVGElement("stop",r,{"stop-color":"rgb("+o+","+o+","+o+")",offset:""+10*a+"%"})},U._defaultCanvas=null,U.getDefaultCanvas=function(){return U._defaultCanvas||(U._defaultCanvas=U._genDefaultCanvas()),U._defaultCanvas},U._genDefaultCanvas=function(){var t,e,i,s,n,a=200,o=200,r=U.genCanvas(a,o),h=r.getContext("2d"),l=h.createImageData(a,o),c=l.data,d=10,u=.4*d;for(t=0;o>t;t++)for(s=10+Math.floor(Math.random()*d),e=0;a>e;e++)i=4*a*t+4*e,n=Math.floor(s-u+2*u*Math.random()),c[i++]=n,c[i++]=n+5,c[i++]=n+10,c[i]=255;return h.putImageData(l,0,0),r},U.saverMethod=function(t){var e=[];return function(){var i,s=!1;for(arguments.length!=e.length&&(e=[]),i=0;i<arguments.length;i++)arguments[i]!==e[i]&&(e[i]=arguments[i],s=!0);s&&t.apply(this,arguments)}};var W={};W.Whenable=function(){this._emitted=!1,this._listeners=[],this._result=[]},W.Whenable.prototype.emit=function(){if(!this._emitted){this._emitted=!0;for(var t=0;t<arguments.length;t++)this._result.push(arguments[t]);for(var e;e=this._listeners.pop();)m.async(e[0],e[1],this._result)}},W.Whenable.prototype.getSubscriber=function(){var t=this;return function(e,i){t._whenEmitted(e,i)}},W.Whenable.prototype._whenEmitted=function(t,e){this._emitted?m.async(t,e,this._result):this._listeners.push([t,e||null])},W.whenAll=function(){if(1==arguments.length)return arguments[0];var t=new W.Whenable,e=arguments[0],i=[].slice.call(arguments,1),s=W.whenAll.apply(null,i);return e(function(){s(function(){t.emit()})}),t.getSubscriber()};var P=function(t){this._setter=t,this._current=0,this._target=null,this._delta=null,this._animTimeout=null};P.prototype.jump=function(t){if(this._animTimeout){var e=this._current,i=this._target,s=t;i>e&&s>i||e>i&&i>s?(this._delta*=(s-e)/(i-e),this._target=t):i>e&&e>s||e>i&&s>e?(this._clearTimeout(),this._applyValue(t)):this._target=t}else this._applyValue(t)},P.prototype.slide=function(t){this._target=t,this._target!=this._current&&(this._delta=(this._target-this._current)*e.animationDelay/e.animationTime),this._animTimeout||this._tick()},P.prototype._tick=function(){if(Math.abs(this._target-this._current)<Math.abs(this._delta))this._animTimeout&&this._clearTimeout(),this._applyValue(this._target);else{var t=this;this._animTimeout=setTimeout(function(){t._tick()},e.animationDelay),this._applyValue(this._current+this._delta)}},P.prototype._applyValue=function(t){this._current=t,this._setter(t)},P.prototype._clearTimeout=function(){clearTimeout(this._animTimeout),this._animTimeout=null};var H={},j=function(t){return"undefined"!=typeof H[t]?H[t]:(H[t]=this,this._url=t,this._touchTimeout=null,this._ready=new W.Whenable,this.whenReady=this._ready.getSubscriber(),this._sides={},this._data={},this._SVGImage=null,this._SVGImageId=null,this._download(),void 0)};j.prototype._download=function(){if(this._url){this._img=s.img.cloneNode(!1),this._img.src=this._url,this._img.style.display="none";var t=this;this._img.addEventListener("load",function(){t._img.parentNode.removeChild(t._img),t._init(t._img),t._ready.emit()},!1),this._img.addEventListener("error",function(){t._img.parentNode.removeChild(t._img),t._init(null),t._ready.emit()},!1),document.body.appendChild(this._img)}else this._init(null),this._ready.emit()},j.prototype.getSide=function(t){return"undefined"==typeof this._sides[t]&&(this._sides[t]=this._rotate(this._sides.north,t)),this._sides[t]};var F=0;j.prototype.getSVGImageId=function(){if(!this._SVGImage){this._SVGImageId="SVG-Image-"+F++ +"-"+i;var t=this._sides.north,e=U.getCanvasDataURL(t),s=U.getCommonSVGDefs();this._SVGImage=U.genSVGElement("image",s,{id:this._SVGImageId,x:"0",y:"0",width:U.px(t.width),height:U.px(t.height),preserveAspectRatio:"none"}),this._SVGImage.setAttributeNS(U._xlinkNS,"xlink:href",e[0])}return this._SVGImageId},j.prototype.touchSVGImage=function(){if(r&&this._SVGImage){this._touchTimeout&&clearTimeout(this._touchTimeout);var t=this;this._touchTimeout=setTimeout(function(){t._touch()},10)}},j.prototype._touch=function(){this._SVGImage.setAttribute("height",U.px(this._data.stretchedSize))},j.prototype.getData=function(){return this._data},j.prototype._init=function(t){var e=this._genImageCanvas(t),i=this._stretch(e);this._sides.north=i.canvas,this._data=this._genData(i.canvas),this._data.points=i.points,this._data.origSize=e.height},j.prototype._genImageCanvas=function(t){var e;return e=t?U.img2canvas(t):U.getDefaultCanvas()},j.prototype._stretch=function(t){var e,i,s,n,a,o,r,h,l,c,d,u,p,_=t.width,m=t.height,g=t.getContext("2d").getImageData(0,0,_,m),f=68*m/35,y=Math.floor(f),v=U.genCanvas(_,y),b=v.getContext("2d"),k=b.createImageData(_,y),w=g.data,x=k.data,S=4*_,C=[],V=15/68,G=12/17,I=45/68,M=24/17;for(i=0;y>i;i++)for(a=i/f,o=a*a,e=I*o-M*a+1,r=V*o*a-G*o+a,s=r*f,n=Math.floor(s),C[n]=i,h=Math.min(e,n+1-s),l=e-h,c=S*n,d=S*i,u=0;_>u;u++){for(p=0;4>p;p++)x[d+p]=Math.round((h*w[c+p]+l*(w[c+p+S]||0))/e);c+=4,d+=4}return b.putImageData(k,0,0),{canvas:v,points:C}},j.prototype._rotate=function(t,e){var i,s=t.width,n=t.height;i=U.isVertical[e]?U.genCanvas(s,n):U.genCanvas(n,s);var a=i.getContext("2d");switch(e){case"east":a.rotate(Math.PI/2),a.drawImage(t,0,-n);break;case"south":a.rotate(Math.PI),a.drawImage(t,-s,-n);break;case"west":a.rotate(-Math.PI/2),a.drawImage(t,-s,0)}return i},j.prototype._genData=function(t){for(var i=t.width,s=t.height,n=0,a=s,o=1;o<e.blocksNumber;o++)a/=4,n+=Math.floor(a);var r=1+Math.ceil(Math.log(1/s)/Math.log(.25)),h=0;for(a=s,o=1;r>o;o++)a/=4,h+=Math.floor(a);return{stretchedSize:s,sideSize:i,maxIntensity:n,virtualPow:1-Math.pow(.25,r-1),virtualSize3:3*h}};var X=function(t,e,i){if(this._elem=t,this._isBody=e,this._listener=i,this._isBody)window.addEventListener("resize",this._listener,!1),"complete"==document.readyState?this._listener():window.addEventListener("load",this._listener,!1);else{this._detector=s.object.cloneNode(!1),U.setStyle(this._detector,{display:"block",position:"absolute",top:"0px",left:"0px",height:"100%",width:"100%",overflow:"hidden",pointerEvents:"none",zIndex:-2048});var n=this;this._detector.onload=function(){this.contentDocument.defaultView.addEventListener("resize",n._listener,!1),n._listener()},this._detector.type="text/html",r?(this._elem.appendChild(this._detector),this._detector.data="about:blank"):(this._detector.data="about:blank",this._elem.appendChild(this._detector))}};X.prototype.destroy=function(){this._isBody?window.removeEventListener("resize",this._listener,!1):this._elem.removeChild(this._detector)};var Y=function(t){this._destroyed=!1,this._elem=t,this._isBody=this._elem==document.body,this._cmp={},this._sideReady={},this._images={},this._indicators={},this._totals={},this._sizes={},this._addendum={},this._lastOrigCoord={},this._createElemStructure();var e,i,s=this._cmp.scroller.getBoundingClientRect(),n=this._cmp.scroller.scrollWidth,a=this._cmp.scroller.scrollHeight;for(e=0;e<U.dir.length;e++)i=U.dir[e],this._indicators[i]=null,this._sideReady[i]=!1,this._addendum[i]=0,this._lastOrigCoord[i]=0,this._totals[i]=U.isVertical[i]?a:n,this._sizes[i]=U.isVertical[i]?s.height:s.width;this._loadImages()};Y.prototype.getElem=function(){return this._elem},Y.prototype.getScroller=function(){return this._cmp.scroller},Y.prototype._createElemStructure=function(){this._createElements(),this._createResizer(),this._createSides()},Y.prototype._createElements=function(){this._cmp.wrapper=s.div.cloneNode(!1),this._cmp.contextor=s.div.cloneNode(!1),this._cmp.scroller=s.div.cloneNode(!1),this._cmp.pusher=s.div.cloneNode(!1),this._cmp.container=s.div.cloneNode(!1);var t={elem:{overflow:"hidden",padding:"0px"},wrapper:{position:"relative",overflow:"hidden",width:"100%",height:"100%"},contextor:{position:"absolute",overflow:"hidden",width:"100%",height:"100%"},scroller:{position:"absolute",overflow:"scroll",zIndex:0},container:{}};if(this._origStyle={overflow:this._elem.style.overflow},this._isBody){var e,i,n=["margin","marginTop","marginRight","marginBottom","marginLeft"],a=window.getComputedStyle(this._elem,null);for(e=0;e<n.length;e++)i=n[e],t.container[i]=a[i],this._origStyle[i]=this._elem.style[i];t.elem.margin=0}U.setStyle(this._elem,t.elem),U.setStyle(this._cmp.wrapper,t.wrapper),U.setStyle(this._cmp.contextor,t.contextor),U.setStyle(this._cmp.scroller,t.scroller),m.floatLeft(this._cmp.pusher),U.setStyle(this._cmp.container,t.container),m.stackingContext(this._cmp.contextor),U.attachChildren(this._cmp.container,U.detachChildren(this._elem)),this._cmp.pusher.appendChild(this._cmp.container),this._cmp.scroller.appendChild(this._cmp.pusher),this._cmp.contextor.appendChild(this._cmp.scroller),this._cmp.wrapper.appendChild(this._cmp.contextor),this._elem.appendChild(this._cmp.wrapper)},Y.prototype._createResizer=function(){var t=this,e=function(){t._setGeometry(),t._indicate()};this._resizer=new X(this._cmp.wrapper,this._isBody,e)},Y.prototype._createSides=function(){this._sides={};for(var t,e=["west","east","south","north"],i=0;i<e.length;i++)t=e[i],this._sides[t]=J(t),this._cmp.contextor.appendChild(this._sides[t])},Y.prototype._restoreElemStructure=function(){this._resizer.destroy();var t=U.detachChildren(this._cmp.container);U.detachChildren(this._elem);for(var e in this._origStyle)this._origStyle.hasOwnProperty(e)&&(this._elem.style[e]=this._origStyle[e]);U.attachChildren(this._elem,t)},Y.prototype._setGeometry=function(){var t=this._cmp.wrapper.getBoundingClientRect();U.setStyle(this._cmp.pusher,{width:U.px(Math.ceil(t.width)),height:U.px(Math.ceil(t.height))})},Y.prototype._loadImages=function(){for(var t,e,i,s=this,n={},a=this._elem.getAttribute("scrollimg")||"",o=0;o<U.dir.length;o++)e=U.dir[o],i=this._elem.getAttribute("scrollimg"+e),t=new j(i||a),n[e]=new W.Whenable,t.whenReady(function(t,e){return function(){s._destroyed||(s._indicators[t]=new q(t,s._cmp.contextor,s._sides[t],e),s._sideReady[t]=!0,n[t].emit())}}(e,t)),this._images[e]=t;W.whenAll(n.north.getSubscriber(),n.east.getSubscriber(),n.south.getSubscriber(),n.west.getSubscriber())(function(){s._indicate(!0)}),this._cmp.scroller.addEventListener("scroll",function(){s._indicate()},!1)},Y.prototype._indicate=function(t){for(var e=this._cmp.wrapper.getBoundingClientRect(),i=this._getScrollInfo(),s=this._getBeyond(e,i),n=this._getInfinite(),a=0;a<U.dir.length;a++){var o=U.dir[a];if(this._sideReady[o]){var r=this._indicators[o],h=this._images[o].getData(),l=this._haveSizesChanged(o,e),c=this._haveTotalsChanged(o,i),d=this._getOrigCoord(o,s,h.origSize,c||l),u=U.isVertical[o]?e.height:e.width,p=this._getIntensity(s[o],n[o],h.maxIntensity,u),_=s[U.isVertical[o]?"west":"north"];("north"==o||"east"==o)&&(_=-_),r.update(e.width,e.height,h.points[d],_,p,c,t)}}},Y.prototype._getScrollInfo=function(){var t=this._cmp.scroller;return{width:t.scrollWidth,height:t.scrollHeight,top:t.scrollTop,left:t.scrollLeft}},Y.prototype._getBeyond=function(t,e){return{north:this._fixCoord(e.top),south:this._fixCoord(e.height-e.top-t.height),west:this._fixCoord(e.left),east:this._fixCoord(e.width-e.left-t.width)}},Y.prototype._fixCoord=function(t){return Math.max(0,Math.floor(t))},Y.prototype._getOrigCoord=function(t,e,i,s){var n=e[t],a=this._mod(n,i);if(s){var o=a-this._lastOrigCoord[t];this._addendum[t]-=o,this._addendum[t]=this._addendum[t]%i}return this._lastOrigCoord[t]=a,a+=this._addendum[t],a=this._mod(a,i)},Y.prototype._getInfinite=function(){var t,e,i={};for(e=0;e<U.dir.length;e++)t=U.dir[e],i[t]=null!==this._elem.getAttribute("scrollinfinite"+t);return i},Y.prototype._haveSizesChanged=function(t,e){var i=!1,s=U.isVertical[t]?e.height:e.width;return this._sizes[t]!=s&&(i=!0,this._sizes[t]=s),i},Y.prototype._haveTotalsChanged=function(t,e){var i=U.isVertical[t]?e.height:e.width,s=!1;return this._totals[t]!=i&&(s=!0,this._totals[t]=i),s},Y.prototype._mod=function(t,e){return t%=e,t+=e,t%=e,t==e&&(t=0),t},Y.prototype._getIntensity=function(t,i,s,n){var a=i?1:1-1/(t*e.indicatorGain+1),o=Math.min(s,e.indicatorMaxArea*n),r=1,h=r+Math.ceil(a*(o-r));return h},Y.prototype.destroy=function(){this._restoreElemStructure(),this._destroyed=!0};var q=function(t,e,i,s){var n=e.getBoundingClientRect();this._offsets=[],this._offset=0,this._parentWidth=n.width,this._parentHeight=n.height,this._scrollAmount=0,this._shown=0,this._coordinates=[],this._sizes=[],this._intensity=0,this._image=s,this._data=s.getData(),this._container=new it(t,e,i,s,this._parentWidth,this._parentHeight),this._setParentGeometry=U.saverMethod(this._setParentGeometry),this._setScrollAmount=U.saverMethod(this._setScrollAmount),this._updateIntensity=U.saverMethod(this._updateIntensity),this._setOffset=U.saverMethod(this._setOffset);var a=this,o=function(t){a._updateIntensity(t,a._parentWidth,a._parentHeight)};this._intensityAnimator=new P(o)};q.prototype.update=function(t,e,i,s,n,a,o){this._image.touchSVGImage(),this._setParentGeometry(t,e),this._setScrollAmount(i),this._setOffset(s),o?(this._intensityAnimator.jump(0),this._intensityAnimator.slide(n)):a?this._intensityAnimator.slide(n):this._intensityAnimator.jump(n)},q.prototype._setParentGeometry=function(t,e){this._parentWidth=t,this._parentHeight=e,this._container.updateParentGeometry(t,e)},q.prototype._setScrollAmount=function(t){this._scrollAmount=t,this._recalculateCoordinates(),this._updateBlocks()},q.prototype._setOffset=function(t){this._offset=t,this._updateOffset()},q.prototype._recalculateCoordinates=function(){var t=this._data,i=this._scrollAmount/t.stretchedSize,s=t.virtualSize3/(t.virtualPow+3*i),n=s*i,a=0;this._sizes=[];for(var o=s,r=0;r<e.blocksNumber;r++)this._sizes.unshift(s),a+=s,s/=4;this._coordinates=[];var h=Math.round(t.maxIntensity-a+o-n);for(r=0;r<e.blocksNumber;r++)this._coordinates.push(h),h+=this._sizes[r]},q.prototype._updateIntensity=function(t,e,i){this._intensity=t,this._container.updateIntensity(t,e,i),this._updateBlocks()},q.prototype._calculateShown=function(t){for(var i=e.blocksNumber,s=0;s<e.blocksNumber;s++)if(this._coordinates[s]>t){i=s;break}return i},q.prototype._updateOffset=function(){for(var t=0;t<this._shown;t++)this._offsets[t]!=this._offset&&(this._offsets[t]=this._offset,this._container.updateOffset(t,this._offset,this._parentWidth,this._parentHeight))},q.prototype._updateBlocks=function(){this._updateShown(),this._container.startBlocksUpdate();for(var t=0;t<this._shown;t++)this._updateBlock(t);this._container.endBlocksUpdate()},q.prototype._updateShown=function(){var t,e=this._shown;if(this._shown=this._calculateShown(this._intensity),this._shown>e)for(t=e;t<this._shown;t++)this._updateBlock(t),this._container.showBlock(t);else if(this._shown<e)for(t=this._shown;e>t;t++)this._container.hideBlock(t)},q.prototype._updateBlock=function(t){this._container.updateBlockGeometry(t,this._coordinates[t],this._sizes[t],this._intensity,this._parentWidth,this._parentHeight),this._container.updateOffset(t,this._offset,this._parentWidth,this._parentHeight)};var J=function(t){var e=s.div.cloneNode(!1),i={pointerEvents:"none",display:"inline",position:"absolute",overflow:"hidden",width:"0px",height:"0px",top:"0px",left:"0px",zIndex:"0"};switch(t){case"north":i.top="-1px";break;case"east":case"south":break;case"west":i.left="-1px"}return U.setStyle(e,i),e},K=function(t,e,i,s,n){var a={};U.isVertical[e]?a.height=U.px(i):a.width=U.px(i);var o=U.isVertical[e]?n:s,r=o-i;switch(e){case"west":case"north":break;case"east":a.left=U.px(r+2);break;case"south":a.top=U.px(r+2)}U.setStyle(t,a)},Q=function(t,e,i,s){this._dir=t,this._isVertical=U.isVertical[t],this._parent=e,this._side=i,this._image=s,this._blocks=[],m.gradientMask(this._side,this._dir),this._createBlocks()};Q.prototype._createBlocks=function(){var t=this._image.getSide(this._dir),i={position:"absolute",display:"none"};this._isVertical?i.width="100%":i.height="100%";for(var n,a=0;a<e.blocksNumber;a++)n=s.div.cloneNode(!1),U.setStyle(n,i),m.backgroundCanvas(n,t),this._side.appendChild(n),this._blocks.push(n)},Q.prototype.showBlock=function(t){this._blocks[t].style.display="block"},Q.prototype.hideBlock=function(t){this._blocks[t].style.display="none"},Q.prototype.updateIntensity=function(t,e,i){K(this._side,this._dir,t,e,i)},Q.prototype.updateOffset=function(t,e){("south"==this._dir||"west"==this._dir)&&(e=-e),e-=1;var i;i=this._isVertical?U.px(e)+" 0px":"0px "+U.px(e),this._blocks[t].style.backgroundPosition=i},Q.prototype.updateParentGeometry=function(t,e){var i={};this._isVertical?i.width=U.px(t+2):i.height=U.px(e+2),U.setStyle(this._side,i)},Q.prototype.updateBlockGeometry=function(t,e,i,s){("south"==this._dir||"east"==this._dir)&&(e=s-i-e);var n,a=this._image.getData().sideSize;n=this._isVertical?{top:U.px(e),height:U.px(i),backgroundSize:U.px(a)+" "+U.px(i)}:{left:U.px(e),width:U.px(i),backgroundSize:U.px(i)+" "+U.px(a)},U.setStyle(this._blocks[t],n)},Q.prototype.startBlocksUpdate=function(){},Q.prototype.endBlocksUpdate=function(){};var Z=function(){var t=U.genSVGElement("svg"),i=U.genSVGElement("defs",t);U.genSVGLinearGradient(i,null,null);var s=U.genSVGElement("mask",i,{x:"0",y:"0",width:"100%",height:"100%"});U.genSVGElement("rect",s,{x:"0",y:"0",width:"0",height:"0"});for(var n=U.genSVGElement("g",t),a=[],o=[],r=[],h=0;h<e.blocksNumber;h++)a[h]=U.genSVGElement("pattern",i,{x:"0",y:"0",width:"0px",height:"0px",patternUnits:"userSpaceOnUse"}),o[h]=U.genSVGElement("use",a[h]),r[h]=U.genSVGElement("rect",n,{x:"0px",y:"0px"});return U.setStyle(t,{position:"absolute",top:"0px",left:"0px",width:"0px",height:"0px"}),t};if("svg"==p.blocks)var $=Z();var tt=function(t,e,i,s,n,a){this._dir=t,this._isVertical=U.isVertical[t],this._parent=e,this._side=i,this._image=s,this._blockcount=tt._svgBlockCounter++,this._svg=null,this._maskRect=null,this._defs=null,this._g=null,this._patterns=null,this._uses=null,this._rects=null,this._setMask(),this._createBlocks(n,a)};tt._svgBlockCounter=0,tt.prototype._setMask=function(){var t="svg-gradient-"+this._blockcount+"-"+i,e="svg-mask-"+this._blockcount+"-"+i,s=$.cloneNode(!0),n={north:"y2",east:"x1",south:"y1",west:"x2"},a=s.childNodes[0],o=a.childNodes[0];o.setAttribute("id",t),o.setAttribute(n[this._dir],"100%");var r=a.childNodes[1];r.setAttribute("id",e);var h=this._isVertical?"100%":0,l=this._isVertical?0:"100%",c=r.childNodes[0];U.setAttributes(c,{width:h,height:l,style:"stroke: none; fill: url(#"+t+")"});var d=s.childNodes[1];d.setAttribute("style","mask:url(#"+e+");"),U.setStyle(s,{position:"absolute",top:"0px",left:"0px",width:U.px(h),height:U.px(l)}),this._side.appendChild(s),this._svg=s,this._defs=a,this._maskRect=c,this._g=d},tt.prototype._createBlocks=function(t,s){var n=this._image.getSide(this._dir),a="svg-blockset-"+this._blockcount+"-"+i,o=this._isVertical?n.width:0,r=this._isVertical?0:n.height,h=this._isVertical?t:0,l=this._isVertical?0:s,c=this._image.getSVGImageId();this._patterns=[],this._uses=[],this._rects=[];for(var d,u,p,_=0;_<e.blocksNumber;_++)d="pattern-"+_+"-"+a,this._patterns[_]=this._defs.childNodes[_+2],U.setAttributes(this._patterns[_],{id:d,width:U.px(o),height:U.px(r)}),u="use-"+_+"-"+a,this._uses[_]=this._patterns[_].childNodes[0],this._uses[_].setAttribute("id",u),this._uses[_].setAttributeNS(U._xlinkNS,"xlink:href","#"+c),p="rect-"+_+"-"+a,this._rects[_]=this._g.childNodes[_],U.setAttributes(this._rects[_],{id:p,width:U.px(h),height:U.px(l),style:"fill: url(#"+d+");"}),this._uses[_].setAttribute("transform","matrix(1 0 0 1 0 0)")},tt.prototype.showBlock=function(){},tt.prototype.hideBlock=function(t){var e={};U.isVertical[this._dir]?e.height="0px":e.width="0px",U.setAttributes(this._rects[t],e)},tt.prototype.updateIntensity=function(t,e,i){K(this._side,this._dir,t,e,i);var s={};this._isVertical?s.height=U.px(t):s.width=U.px(t),U.setStyle(this._svg,s),U.setAttributes(this._svg,s),U.setAttributes(this._maskRect,s)},tt.prototype.updateOffset=function(t,e){("south"==this._dir||"west"==this._dir)&&(e=-e);var i=this._image.getData().sideSize,s=U.px(e%i),n={};n[this._isVertical?"x":"y"]=s,U.setAttributes(this._patterns[t],n)},tt.prototype.updateParentGeometry=function(t,i){var s={};this._isVertical?s.width=U.px(t+2):s.height=U.px(i+2),U.setStyle(this._side,s),U.setStyle(this._svg,s),U.setAttributes(this._svg,s);for(var n=0;n<e.blocksNumber;n++)U.setAttributes(this._rects[n],s)},tt.prototype.updateBlockGeometry=function(t,e,i,s){("south"==this._dir||"east"==this._dir)&&(e=s-i-e);var n,a=i/this._image.getData().stretchedSize;n=this._isVertical?{y:U.px(e),height:U.px(i)}:{x:U.px(e),width:U.px(i)},U.setAttributes(this._rects[t],n),U.setAttributes(this._patterns[t],n);var o=this._image.getData(),r=this._uses[t].transform.baseVal.getItem(0),h=0,l=0,c=0;switch(this._dir){case"east":h=90,l=o.stretchedSize;break;case"south":h=180,l=o.sideSize,c=o.stretchedSize;break;case"west":h=270,c=o.sideSize}var d=1,u=1;this._isVertical?u=a:d=a;var p=U.getCommonSVG().createSVGMatrix().scaleNonUniform(d,u).translate(l,c).rotate(h);r.setMatrix(p)},tt.prototype.startBlocksUpdate=function(){this._side.style.display="none"},tt.prototype.endBlocksUpdate=function(){this._side.style.display="block"};var et=function(t,e,i,s){this._dir=t,this._isVertical=U.isVertical[t],this._parent=e,this._side=i,this._image=s,this._canvas=s.getSide("north"),this._blocks=[],this._setMask(),this._createBlocks()};et.prototype._setMask=function(){var t={WebkitTransformOrigin:"0 0"};switch(this._dir){case"north":t.top="-1px",t.left="-1px";break;case"east":t.top="-1px",t.left="1px";break;case"south":t.top="1px",t.left="1px";break;case"west":t.top="-1px",t.left="-1px"}U.setStyle(this._side,t),m.gradientMask(this._side,"north")},et.prototype._createBlocks=function(){for(var t,i=this._image.getSide("north"),n={position:"absolute",width:"100%"},a=0;a<e.blocksNumber;a++)t=s.div.cloneNode(!1),U.setStyle(t,n),m.backgroundCanvas(t,i),this._side.appendChild(t),this._blocks.push(t)},et.prototype.showBlock=function(t){this._blocks[t].style.display="block"},et.prototype.hideBlock=function(t){this._blocks[t].style.display="none"},et.prototype.updateIntensity=function(t){this._side.style.height=U.px(t)},et.prototype.updateOffset=function(t,e,i,s){var n=this._image.getData().sideSize;switch(this._dir){case"north":case"east":e-=1;break;case"south":e+=i-n,e+=1;break;case"west":e+=s-n,e+=1}this._blocks[t].style.backgroundPosition=U.px(e)+" 1px"},et.prototype.updateParentGeometry=function(t,e){var i="",s="";switch(this._dir){case"north":break;case"east":i="rotate(90deg)",s="translate("+t+"px,0px)";break;case"south":i="rotate(180deg)",s="translate("+t+"px,"+e+"px)";break;case"west":i="rotate(270deg)",s="translate(0px,"+e+"px)"}var n={width:U.px((this._isVertical?t:e)+2),WebkitTransform:[s,i].join(" ")};U.setStyle(this._side,n)},et.prototype.updateBlockGeometry=function(t,e,i){var s=this._image.getData().sideSize,n=2;U.setStyle(this._blocks[t],{top:U.px(e),height:U.px(i+n),backgroundSize:U.px(s)+" "+U.px(i)})},et.prototype.startBlocksUpdate=function(){},et.prototype.endBlocksUpdate=function(){};var it;switch(p.blocks){case"svg":it=tt;break;case"div":it=Q;break;case"webkitTransform":it=et}var st=[],nt=function(){if(u)for(var t,e=0;e<st.length;e++)t=st[e].getElem(),m.hasClass(t,"intence")||(st[e].destroy(),t.intence=null,t.scroller=null,delete t.intence,delete t.scroller,st.splice(e,1),e--)},at=function(){var t,e,i=document.getElementsByClassName("intence");for(t=0;t<i.length;t++)if(e=i[t],u){if(!e.intence){var s=new Y(e);st.push(s),e.intence=!0,e.scroller=s.getScroller()}}else e.scroller=e},ot=function(){nt(),at()};"complete"==document.readyState?ot():window.addEventListener("load",ot,!1),t.reset=ot,t.enabled=u});