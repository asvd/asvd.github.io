(function(t,e){if(typeof define==="function"&&define.amd){define(["exports"],e)}else if(typeof exports!=="undefined"){e(exports)}else{e(t.intence={})}})(this,function(t){var e={textureMaxSqueeze:1e3,indicatorMaxArea:.16,indicatorGain:1/3e3,animationTime:160,animationDelay:20};e.blocksNumber=1+Math.ceil(Math.log(e.textureMaxSqueeze)/Math.log(4));var i="intence-unique-"+(new Date).getTime();var s={div:document.createElement("div"),img:document.createElement("img"),canvas:document.createElement("canvas"),object:document.createElement("object")};var a=function(t,e,i){var a,r=t;while((a=r.indexOf("-"))!=-1){r=r.slice(0,a)+r.slice(a+1,a+2).toUpperCase()+r.slice(a+2)}var n=s.div.cloneNode(false);var o=t+": "+e;if(i){o+="("+i+")"}n.style.cssText=o;return r in document.documentElement.style&&n.style[r].indexOf(e)!="-1"};var r=false||!!document.documentMode;var n=typeof InstallTrigger!=="undefined";var o={classList:!!s.div.classList,event:!!window.addEventListener,canvas:!!s.canvas.getContext,isolation:a("isolation","isolate"),opacity:a("opacity",".5"),transform:a("transform","translate3d","0, 0, 0"),webkitTransform:a("-webkit-transform","rotate","-180deg"),backgroundCanvas:{webkit:!!document.getCSSCanvasContext&&a("background","-webkit-canvas","a"),mozElement:a("background","-moz-element","#a")},gradientMask:{alphaFilter:a("filter","progid:DXImageTransform.Microsoft.Alpha","opacity=100,finishOpacity=0,style=1,"+"startX=0,finishX=1,startY=0,finishY=1"),webkit:a("-webkit-mask-image","-webkit-linear-gradient","top, rgba(0,0,0,1), rgba(0,0,0,0) 100%"),svgReuse:n}};var h=r&&o.gradientMask.alphaFilter;var l=true;var c={hasClass:o.classList?"classList":"className",async:o.event?"event":"setTimeout",stackingContext:null,blocks:o.webkitTransform?"webkitTransform":"div",mask:null,canvas:null};if(o.canvas){if(o.gradientMask.webkit){c.mask="webkit";c.canvas=o.backgroundCanvas.webkit?"webkit":"dataURL"}else if(o.gradientMask.svgReuse){if(o.backgroundCanvas.mozElement){c.canvas="mozElement";c.mask="svgReuse"}else{c.blocks="svg"}}else if(o.gradientMask.alphaFilter){c.canvas="dataURL";c.mask="alphaFilter";c.blocks="div"}else{c.blocks="svg"}if(o.isolation){c.stackingContext="isolation"}else if(!h){if(o.transform){c.stackingContext="transform"}else if(o.opacity){c.stackingContext="opacity"}}}else{l=false}if(c.blocks=="svg"&&!r){l=false}var d={};var u=function(t,e){var i={north:"top",east:"right",south:"bottom",west:"left"};t.style.WebkitMaskImage="-webkit-linear-gradient("+i[e]+", "+"rgba(0,0,0,1), rgba(0,0,0,0) 100%)"};var _=function(t,e){var i={x1:0,x2:0,y1:0,y2:0};var s={north:"y2",east:"x1",south:"y1",west:"x2"};i[s[e]]="100";var a="progid:DXImageTransform.Microsoft.Alpha("+"opacity=100,"+"finishOpacity=0,"+"style=1,"+"startX="+i.x1+","+"finishX="+i.x2+","+"startY="+i.y1+","+"finishY="+i.y2+""+")";t.style.filter=a};var p={north:null,east:null,south:null,west:null};var f=function(t,e){if(!p[e]){p[e]=v(e)}t.style.mask="url(#"+p[e]+")"};var v=function(t){var e="svg-mask-"+t+"-"+i;var s="mask-"+e;var a="gradient-"+e;var r=B.genSVGElement("svg");var n=B.genSVGElement("defs",r);var o=B.genSVGLinearGradient(n,t,a);var h=B.genSVGElement("mask",n,{id:s,maskUnits:"objectBoundingBox",maskContentUnits:"objectBoundingBox"});var l=B.genSVGElement("rect",h,{y:"0",width:"1",height:"1",fill:"url(#"+a+")"});B.setStyle(r,{position:"absolute",width:"0px",height:"0px"});document.body.appendChild(r);return s};switch(c.mask){case"svgReuse":d.gradientMask=f;break;case"webkit":d.gradientMask=u;break;case"alphaFilter":d.gradientMask=_;break}var m=function(t){t.style.isolation="isolate"};var g=function(t){t.style.transform="translate3d(0,0,0)"};var y=function(t){t.style.opacity=.9999999};switch(c.stackingContext){case"isolation":d.stackingContext=m;break;case"transform":d.stackingContext=g;break;case"opacity":d.stackingContext=y;break;default:d.stackingContext=function(){};break}var b=function(t,e){t.style.backgroundImage="url("+B.getCanvasDataURL(e)[0]+")"};var k=0;var w=function(t,e){if(typeof e.CSSContextId=="undefined"){var s="canvasCSSContext-"+k++ +"-"+i;var a=document.getCSSCanvasContext("2d",s,e.width,e.height);a.drawImage(e,0,0);e.CSSContextId=s}t.style.background="-webkit-canvas("+e.CSSContextId+")"};var x=0;var S=function(t,e){if(!e.getAttribute("id")){var s="MozElement-"+x++ +"-"+i;e.setAttribute("id",s);B.setStyle(e,{position:"absolute",width:"0px",height:"0px"});document.body.appendChild(e)}t.style.background="-moz-element(#"+e.getAttribute("id")+")"};switch(c.canvas){case"dataURL":d.backgroundCanvas=b;break;case"webkit":d.backgroundCanvas=w;break;case"mozElement":d.backgroundCanvas=S;break}var C=function(t,e,i){setTimeout(function(){t.apply(e||null,i||[])},0)};var V=function(t,e,i){G.push([t,e||window,i]);window.postMessage(I,"*")};var G=[];var I="async-"+i;var M=function(t){if(t.source==window&&t.data==I){if(G.length>0){var e=G.shift();e[0].apply(e[1],e[2])}}};if(c.async=="event"){window.addEventListener("message",M,true);d.async=V}else{d.async=C}var z=function(t,e){var i=false;var s=t.classList;for(var a=0;a<s.length;a++){if(s[a]==e){i=true;break}}return i};var A=function(t,e){var i=false;var s=t.className.split(" ");for(var a=0;a<s.length;a++){if(s[a]==e){i=true;break}}return i};if(c.hasClass=="classList"){d.hasClass=z}else{d.hasClass=A}var B={};B.dir=["north","east","south","west"];B.isVertical={north:true,east:false,south:true,west:false};B.ccv={north:"west",east:"north",south:"east",west:"south"};B.setStyle=function(t,e){for(var i in e){if(e.hasOwnProperty(i)){t.style[i]=e[i]}}};B.setAttributes=function(t,e){for(var i in e){if(e.hasOwnProperty(i)){t.setAttribute(i,e[i])}}};B.px=function(t){return""+t+"px"};B.detachChildren=function(t){var e=[];while(t.firstChild){e.push(t.removeChild(t.firstChild))}return e};B.attachChildren=function(t,e){for(var i=0;i<e.length;i++){t.appendChild(e[i])}};B.getCanvasDataURL=function(t){if(typeof t.intence_cached_dataURL=="undefined"){t.intence_cached_dataURL=[t.toDataURL()]}return t.intence_cached_dataURL};B.genCanvas=function(t,e){var i=s.canvas.cloneNode(false);i.width=t;i.height=e;B.setStyle(i,{width:B.px(t),height:B.px(e),display:"none"});return i};B.img2canvas=function(t){var e=B.genCanvas(t.width||t.naturalWidth,t.height||t.naturalHeight);var i=e.getContext("2d");i.drawImage(t,0,0);return e};B._svgNS="http://www.w3.org/2000/svg";B._xlinkNS="http://www.w3.org/1999/xlink";B.genSVGElement=function(t,e,i){var s=document.createElementNS(B._svgNS,t);if(i){for(var a in i){if(i.hasOwnProperty(a)){if(a.indexOf("xlink")!=-1){s.setAttributeNS(B._xlinkNS,a,i[a])}else{s.setAttribute(a,i[a])}}}}if(e){e.appendChild(s)}return s};B._commonSVG=null;B.getCommonSVG=function(){if(!B._commonSVGDefs){B._commonSVG=B.genSVGElement("svg",document.body);B.setStyle(B._commonSVG,{width:"0px",height:"0px",position:"absolute",display:"none"})}return B._commonSVG};B._commonSVGDefs=null;B.getCommonSVGDefs=function(){if(!B._commonSVGDefs){B._commonSVGDefs=B.genSVGElement("defs",B.getCommonSVG())}return B._commonSVGDefs};B.genSVGLinearGradient=function(t,e,i){var s={x1:"0%",y1:"0%",x2:"0%",y2:"0%"};if(e){var a={north:"y2",east:"x1",south:"y1",west:"x2"};s[a[e]]="100%"}if(i){s.id=i}var r=B.genSVGElement("linearGradient",t,s);var n=B.genSVGElement("stop",r,{"stop-color":"white",offset:"0%"});var o=B.genSVGElement("stop",r,{"stop-color":"black",offset:"100%"});return r};B._defaultCanvas=null;B.getDefaultCanvas=function(){if(!B._defaultCanvas){B._defaultCanvas=B._genDefaultCanvas()}return B._defaultCanvas};B._genDefaultCanvas=function(){var t=200,e=200;var i=B.genCanvas(t,e);var s=i.getContext("2d");var a=s.createImageData(t,e);var r=a.data;var n=10;var o=n*.4;var h,l,c,d,u,_;for(h=0;h<e;h++){u=10+Math.floor(Math.random()*n);for(l=0;l<t;l++){c=4*t*h+4*l;_=Math.floor(u-o+2*o*Math.random());r[c++]=_;r[c++]=_+5;r[c++]=_+10;r[c]=255}}s.putImageData(a,0,0);return i};B.saverMethod=function(t){var e=[];return function(){var i,s=false;if(arguments.length!=e.length){e=[]}for(i=0;i<arguments.length;i++){if(arguments[i]!==e[i]){e[i]=arguments[i];s=true}}if(s){t.apply(this,arguments)}}};var E={};E.Whenable=function(){this._emitted=false;this._listeners=[];this._result=[]};E.Whenable.prototype.emit=function(){if(!this._emitted){this._emitted=true;for(var t=0;t<arguments.length;t++){this._result.push(arguments[t])}var e;while(e=this._listeners.pop()){d.async(e[0],e[1],this._result)}}};E.Whenable.prototype.getSubscriber=function(){var t=this;return function(e,i){t._whenEmitted(e,i)}};E.Whenable.prototype._whenEmitted=function(t,e){if(this._emitted){d.async(t,e,this._result)}else{this._listeners.push([t,e||null])}};E.whenAll=function(){if(arguments.length==1){return arguments[0]}else{var t=new E.Whenable;var e=arguments[0];var i=[].slice.call(arguments,1);var s=E.whenAll.apply(null,i);e(function(){s(function(){t.emit()})});return t.getSubscriber()}};var N=function(t){this._setter=t;this._current=0;this._target=null;this._delta=null;this._animTimeout=null};N.prototype.jump=function(t){if(this._animTimeout){var e=this._current,i=this._target,s=t;if(i>e&&s>i||i<e&&s<i){this._delta*=(s-e)/(i-e);this._target=t}else if(i>e&&s<e||i<e&&s>e){this._clearTimeout();this._applyValue(t)}else{this._target=t}}else{this._applyValue(t)}};N.prototype.slide=function(t){this._target=t;if(this._target!=this._current){this._delta=(this._target-this._current)*e.animationDelay/e.animationTime}if(!this._animTimeout){this._tick()}};N.prototype._tick=function(){if(Math.abs(this._target-this._current)<Math.abs(this._delta)){if(this._animTimeout){this._clearTimeout()}this._applyValue(this._target)}else{var t=this;this._animTimeout=setTimeout(function(){t._tick()},e.animationDelay);this._applyValue(this._current+this._delta)}};N.prototype._applyValue=function(t){this._current=t;this._setter(t)};N.prototype._clearTimeout=function(){clearTimeout(this._animTimeout);this._animTimeout=null};var D={};var T=function(t){if(typeof D[t]!="undefined"){return D[t]}else{D[t]=this;this._url=t;this._touchTimeout=null;this._ready=new E.Whenable;this.whenReady=this._ready.getSubscriber();this._sides={};this._data={};this._SVGImage=null;this._SVGImageId=null;this._download()}};T.prototype._download=function(){if(!this._url){this._init(null);this._ready.emit()}else{this._img=s.img.cloneNode(false);this._img.src=this._url;this._img.style.display="none";var t=this;this._img.addEventListener("load",function(){document.body.removeChild(t._img);t._init(t._img);t._ready.emit()},false);this._img.addEventListener("error",function(){document.body.removeChild(t._img);t._init(null);t._ready.emit()},false);document.body.appendChild(this._img)}};T.prototype.getSide=function(t){if(typeof this._sides[t]=="undefined"){this._sides[t]=this._rotate(this._sides.north,t)}return this._sides[t]};var L=0;T.prototype.getSVGImageId=function(){if(!this._SVGImage){this._SVGImageId="SVG-Image-"+L++ +"-"+i;var t=this._sides.north;var e=B.getCanvasDataURL(t);var s=B.getCommonSVGDefs();this._SVGImage=B.genSVGElement("image",s,{id:this._SVGImageId,x:"0",y:"0",width:B.px(t.width),height:B.px(t.height),preserveAspectRatio:"none"});this._SVGImage.setAttributeNS(B._xlinkNS,"xlink:href",e[0])}return this._SVGImageId};T.prototype.touchSVGImage=function(){if(r&&this._SVGImage){if(this._touchTimeout){clearTimeout(this._touchTimeout)}var t=this;this._touchTimeout=setTimeout(function(){t._touch()},10)}};T.prototype._touch=function(){this._SVGImage.setAttribute("height",B.px(this._data.stretchedSize))};T.prototype.getData=function(){return this._data};T.prototype._init=function(t){var e=this._genImageCanvas(t);var i=this._stretch(e);this._sides.north=i.canvas;this._data=this._genData(i.canvas);this._data.points=i.points;this._data.origSize=e.height};T.prototype._genImageCanvas=function(t){var e;if(t){e=B.img2canvas(t)}else{e=B.getDefaultCanvas()}return e};T.prototype._stretch=function(t){var e=t.width;var i=t.height;var s=t.getContext("2d").getImageData(0,0,e,i);var a=i*68/35;var r=Math.floor(a);var n=B.genCanvas(e,r);var o=n.getContext("2d");var h=o.createImageData(e,r);var l=s.data;var c=h.data;var d;var u;var _;var p;var f;var v;var m;var g;var y;var b=e*4;var k;var w;var x;var S;var C=[];var V=15/68;var G=12/17;var I=45/68;var M=24/17;for(u=0;u<r;u++){f=u/a;v=f*f;d=I*v-M*f+1;m=V*v*f-G*v+f;_=m*a;p=Math.floor(_);C[p]=u;g=Math.min(d,p+1-_);y=d-g;k=b*p;w=b*u;for(x=0;x<e;x++){for(S=0;S<4;S++){c[w+S]=Math.round((g*l[k+S]+y*(l[k+S+b]||0))/d)}k+=4;w+=4}}o.putImageData(h,0,0);return{canvas:n,points:C}};T.prototype._rotate=function(t,e){var i=t.width;var s=t.height;var a;if(B.isVertical[e]){a=B.genCanvas(i,s)}else{a=B.genCanvas(s,i)}var r=a.getContext("2d");switch(e){case"east":r.rotate(Math.PI/2);r.drawImage(t,0,-s);break;case"south":r.rotate(Math.PI);r.drawImage(t,-i,-s);break;case"west":r.rotate(-Math.PI/2);r.drawImage(t,-i,0);break}return a};T.prototype._genData=function(t){var i=t.width;var s=t.height;var a=0;var r=s;for(var n=1;n<e.blocksNumber;n++){r/=4;a+=Math.floor(r)}var o=1+Math.ceil(Math.log(1/s)/Math.log(1/4));var h=0;r=s;for(n=1;n<o;n++){r/=4;h+=Math.floor(r)}return{stretchedSize:s,sideSize:i,maxIntensity:a,virtualPow:1-Math.pow(1/4,o-1),virtualSize3:h*3}};var R=function(t,e){this._elem=t;this._isBody=e;var i=this;this._handler=function(){i.onresize()};if(this._isBody){window.addEventListener("resize",this._handler,false)}else{this._detector=s.object.cloneNode(false);B.setStyle(this._detector,{display:"block",position:"absolute",top:"0px",left:"0px",height:"100%",width:"100%",overflow:"hidden",pointerEvents:"none",zIndex:-2048});this._detector.onload=function(){this.contentDocument.defaultView.addEventListener("resize",i._handler,false)};this._detector.type="text/html";if(r){this._elem.appendChild(this._detector);this._detector.data="about:blank"}else{this._detector.data="about:blank";this._elem.appendChild(this._detector)}}};R.prototype.onresize=function(){};R.prototype.destroy=function(){if(this._isBody){window.removeEventListener("resize",this._handler,false)}else{this._elem.removeChild(this._detector)}};var O=function(t){this._destroyed=false;this._elem=t;this._isBody=this._elem.nodeName.toLowerCase()=="body";this._cmp={};this._sideReady={};this._images={};this._indicators={};this._totals={};this._sizes={};this._addendum={};this._lastOrigCoord={};this._createElemStructure();var e=this._cmp.scroller.getBoundingClientRect();var i=this._cmp.scroller.scrollWidth;var s=this._cmp.scroller.scrollHeight;var a,r;for(a=0;a<B.dir.length;a++){r=B.dir[a];this._indicators[r]=null;this._sideReady[r]=false;this._addendum[r]=0;this._lastOrigCoord[r]=0;this._totals[r]=B.isVertical[r]?s:i;this._sizes[r]=B.isVertical[r]?e.height:e.width}this._loadImages()};O.prototype.getElem=function(){return this._elem};O.prototype._createElemStructure=function(){this._createElements();this._createResizer();this._createSides()};O.prototype._createElements=function(){this._cmp.wrapper=s.div.cloneNode(false);this._cmp.contextor=s.div.cloneNode(false);this._cmp.scroller=s.div.cloneNode(false);this._cmp.container=s.div.cloneNode(false);var t={elem:{overflow:"hidden",padding:"0px"},wrapper:{position:"relative",overflow:"hidden",width:"100%",height:"100%"},contextor:{position:"absolute",overflow:"hidden",width:"100%",height:"100%"},scroller:{position:"absolute",overflow:"scroll",zIndex:0},container:{}};this._origStyle={overflow:this._elem.style.overflow};if(this._isBody){var e=["margin","marginTop","marginRight","marginBottom","marginLeft"];var i=window.getComputedStyle(this._elem,null);var a,r;for(a=0;a<e.length;a++){r=e[a];t.container[r]=i[r];this._origStyle[r]=this._elem.style[r]}t.elem.margin=0}B.setStyle(this._elem,t.elem);B.setStyle(this._cmp.wrapper,t.wrapper);B.setStyle(this._cmp.contextor,t.contextor);B.setStyle(this._cmp.scroller,t.scroller);B.setStyle(this._cmp.container,t.container);d.stackingContext(this._cmp.contextor);var n=this._elem.getAttribute("id");if(n){this._cmp.scroller.setAttribute("id",n+"-scroller")}B.attachChildren(this._cmp.container,B.detachChildren(this._elem));this._cmp.scroller.appendChild(this._cmp.container);this._cmp.contextor.appendChild(this._cmp.scroller);this._cmp.wrapper.appendChild(this._cmp.contextor);this._elem.appendChild(this._cmp.wrapper)};O.prototype._createResizer=function(){var t=this;this._resizer=new R(this._cmp.wrapper,this._isBody);this._resizer.onresize=function(){t._setGeometry();t._indicate()};this._setGeometry()};O.prototype._createSides=function(){this._sides={};var t=["west","east","south","north"];var e;for(var i=0;i<t.length;i++){e=t[i];this._sides[e]=W(e);this._cmp.contextor.appendChild(this._sides[e])}};O.prototype._restoreElemStructure=function(){this._resizer.destroy();var t=B.detachChildren(this._cmp.container);B.detachChildren(this._elem);for(var e in this._origStyle){if(this._origStyle.hasOwnProperty(e)){this._elem.style[e]=this._origStyle[e]}}B.attachChildren(this._elem,t)};O.prototype._setGeometry=function(){var t=this._cmp.wrapper.getBoundingClientRect();B.setStyle(this._cmp.container,{width:B.px(Math.ceil(t.width)),height:B.px(Math.ceil(t.height))})};O.prototype._loadImages=function(){var t=this;var e={};var i=this._elem.getAttribute("intenceimg")||"";var s,a,r;for(var n=0;n<B.dir.length;n++){a=B.dir[n];r=this._elem.getAttribute("intenceimg"+a);s=new T(r||i);e[a]=new E.Whenable;s.whenReady(function(i,s){return function(){if(!t._destroyed){t._indicators[i]=new U(i,t._cmp.contextor,t._sides[i],s);t._sideReady[i]=true;e[i].emit()}}}(a,s));this._images[a]=s}E.whenAll(e.north.getSubscriber(),e.east.getSubscriber(),e.south.getSubscriber(),e.west.getSubscriber())(function(){t._indicate(true)});this._cmp.scroller.addEventListener("scroll",function(){t._indicate()},false)};O.prototype._indicate=function(t){var e=this._cmp.wrapper.getBoundingClientRect();var i=this._getScrollInfo();var s=this._getBeyond(e,i);var a=this._getInfinite();for(var r=0;r<B.dir.length;r++){var n=B.dir[r];if(this._sideReady[n]){var o=this._indicators[n];var h=this._images[n].getData();var l=this._haveSizesChanged(n,e);var c=this._haveTotalsChanged(n,i);var d=this._getOrigCoord(n,s,h.origSize,c||l);var u=B.isVertical[n]?e.height:e.width;var _=this._getIntensity(s[n],a[n],h.maxIntensity,u);var p=s[B.isVertical[n]?"west":"north"];if(n=="north"||n=="east"){p=-p}o.update(e.width,e.height,h.points[d],p,_,c,t)}}};O.prototype._getScrollInfo=function(){var t=this._cmp.scroller;return{width:t.scrollWidth,height:t.scrollHeight,top:t.scrollTop,left:t.scrollLeft}};O.prototype._getBeyond=function(t,e){return{north:this._fixCoord(e.top),south:this._fixCoord(e.height-e.top-t.height),west:this._fixCoord(e.left),east:this._fixCoord(e.width-e.left-t.width)}};O.prototype._fixCoord=function(t){return Math.max(0,Math.floor(t))};O.prototype._getOrigCoord=function(t,e,i,s){var a=e[t];var r=this._mod(a,i);if(s){var n=r-this._lastOrigCoord[t];this._addendum[t]-=n;this._addendum[t]=this._addendum[t]%i}this._lastOrigCoord[t]=r;r+=this._addendum[t];r=this._mod(r,i);return r};O.prototype._getInfinite=function(){var t={},e,i;for(i=0;i<B.dir.length;i++){e=B.dir[i];t[e]=this._elem.getAttribute("intenceinfinite"+e)!==null}return t};O.prototype._haveSizesChanged=function(t,e){var i=false;var s=B.isVertical[t]?e.height:e.width;if(this._sizes[t]!=s){i=true;this._sizes[t]=s}return i};O.prototype._haveTotalsChanged=function(t,e){var i=false;var s=this._cmp.scroller;var a=B.isVertical[t]?e.height:e.width;if(this._totals[t]!=a){i=true;this._totals[t]=a}return i};O.prototype._mod=function(t,e){t=t%e;t+=e;t=t%e;if(t==e){t=0}return t};O.prototype._getIntensity=function(t,i,s,a){var r=i?1:1-1/(t*e.indicatorGain+1);var n=Math.min(s,e.indicatorMaxArea*a);var o=1;var h=o+Math.ceil(r*(n-o));return h};O.prototype.destroy=function(){this._restoreElemStructure();this._destroyed=true};var U=function(t,e,i,s){var a=e.getBoundingClientRect();this._offsets=[];this._offset=0;this._parentWidth=a.width;this._parentHeight=a.height;this._scrollAmount=0;this._shown=0;this._coordinates=[];this._sizes=[];this._intensity=0;this._image=s;this._data=s.getData();this._container=new q(t,e,i,s,this._parentWidth,this._parentHeight);this._setParentGeometry=B.saverMethod(this._setParentGeometry);this._setScrollAmount=B.saverMethod(this._setScrollAmount);this._updateIntensity=B.saverMethod(this._updateIntensity);this._setOffset=B.saverMethod(this._setOffset);var r=this;var n=function(t){r._updateIntensity(t,r._parentWidth,r._parentHeight)};this._intensityAnimator=new N(n)};U.prototype.update=function(t,e,i,s,a,r,n){this._image.touchSVGImage();this._setParentGeometry(t,e);this._setScrollAmount(i);this._setOffset(s);if(n){this._intensityAnimator.jump(0);this._intensityAnimator.slide(a)}else if(r){this._intensityAnimator.slide(a)}else{this._intensityAnimator.jump(a)}};U.prototype._setParentGeometry=function(t,e){this._parentWidth=t;this._parentHeight=e;this._container.updateParentGeometry(t,e)};U.prototype._setScrollAmount=function(t){this._scrollAmount=t;this._recalculateCoordinates();this._updateBlocks()};U.prototype._setOffset=function(t){this._offset=t;this._updateOffset()};U.prototype._recalculateCoordinates=function(){var t=this._data;var i=this._scrollAmount/t.stretchedSize;var s=t.virtualSize3/(t.virtualPow+3*i);var a=s*i;var r=0;this._sizes=[];var n=s;for(var o=0;o<e.blocksNumber;o++){this._sizes.unshift(s);r+=s;s/=4}this._coordinates=[];var h=Math.round(t.maxIntensity-r+n-a);for(o=0;o<e.blocksNumber;o++){this._coordinates.push(h);h+=this._sizes[o]}};U.prototype._updateIntensity=function(t,e,i){this._intensity=t;this._container.updateIntensity(t,e,i);this._updateBlocks()};U.prototype._calculateShown=function(t){var i=e.blocksNumber;for(var s=0;s<e.blocksNumber;s++){if(this._coordinates[s]>t){i=s;break}}return i};U.prototype._updateOffset=function(){for(var t=0;t<this._shown;t++){if(this._offsets[t]!=this._offset){this._offsets[t]=this._offset;this._container.updateOffset(t,this._offset,this._parentWidth,this._parentHeight)}}};U.prototype._updateBlocks=function(){this._updateShown();this._container.startBlocksUpdate();for(var t=0;t<this._shown;t++){this._updateBlock(t)}this._container.endBlocksUpdate()};U.prototype._updateShown=function(){var t,e=this._shown;this._shown=this._calculateShown(this._intensity);if(this._shown>e){for(t=e;t<this._shown;t++){this._updateBlock(t);this._container.showBlock(t)}}else if(this._shown<e){for(t=this._shown;t<e;t++){this._container.hideBlock(t)}}};U.prototype._updateBlock=function(t){this._container.updateBlockGeometry(t,this._coordinates[t],this._sizes[t],this._intensity,this._parentWidth,this._parentHeight);this._container.updateOffset(t,this._offset,this._parentWidth,this._parentHeight)};var W=function(t){var e=s.div.cloneNode(false);var i=B.isVertical[t];var a={pointerEvents:"none",display:"inline",position:"absolute",overflow:"hidden",width:"0px",height:"0px",top:"0px",left:"0px",zIndex:"0"};switch(t){case"north":a.top="-1px";break;case"east":case"south":break;case"west":a.left="-1px";break}B.setStyle(e,a);return e};var P=function(t,e,i,s,a){var r={};if(B.isVertical[e]){r.height=B.px(i)}else{r.width=B.px(i)}var n=B.isVertical[e]?a:s;var o=n-i;switch(e){case"west":case"north":break;case"east":r.left=B.px(o+2);break;case"south":r.top=B.px(o+2);break}B.setStyle(t,r)};var H=function(t,e,i,s,a,r){this._dir=t;this._isVertical=B.isVertical[t];this._parent=e;this._side=i;this._image=s;this._blocks=[];d.gradientMask(this._side,this._dir);this._createBlocks()};H.prototype._createBlocks=function(){var t=this._image.getSide(this._dir);var i={position:"absolute",display:"none"};if(this._isVertical){i.width="100%"}else{i.height="100%"}var a;for(var r=0;r<e.blocksNumber;r++){a=s.div.cloneNode(false);B.setStyle(a,i);d.backgroundCanvas(a,t);this._side.appendChild(a);this._blocks.push(a)}};H.prototype.showBlock=function(t){this._blocks[t].style.display="block"};H.prototype.hideBlock=function(t){this._blocks[t].style.display="none"};H.prototype.updateIntensity=function(t,e,i){P(this._side,this._dir,t,e,i)};H.prototype.updateOffset=function(t,e,i,s){if(this._dir=="south"||this._dir=="west"){e=-e}e-=1;var a;if(this._isVertical){a=B.px(e)+" 0px"}else{a="0px "+B.px(e)}this._blocks[t].style.backgroundPosition=a};H.prototype.updateParentGeometry=function(t,e){var i={};if(this._isVertical){i.width=B.px(t+2)}else{i.height=B.px(e+2)}B.setStyle(this._side,i)};H.prototype.updateBlockGeometry=function(t,e,i,s,a,r){if(this._dir=="south"||this._dir=="east"){e=s-i-e}var n=this._image.getData().sideSize;var o;if(this._isVertical){o={top:B.px(e),height:B.px(i),backgroundSize:B.px(n)+" "+B.px(i)}}else{o={left:B.px(e),width:B.px(i),backgroundSize:B.px(i)+" "+B.px(n)}}B.setStyle(this._blocks[t],o)};H.prototype.startBlocksUpdate=function(){};H.prototype.endBlocksUpdate=function(){};var j=function(){var t=B.genSVGElement("svg");var i=B.genSVGElement("defs",t);var s=B.genSVGLinearGradient(i,null,null);var a=B.genSVGElement("mask",i,{x:"0",y:"0",width:"100%",height:"100%"});var r="0";var n="0";var o=B.genSVGElement("rect",a,{x:"0",y:"0",width:"0",height:"0"});var h=B.genSVGElement("g",t);var l=[];var c=[];var d=[];for(var u=0;u<e.blocksNumber;u++){l[u]=B.genSVGElement("pattern",i,{x:"0",y:"0",width:"0px",height:"0px",patternUnits:"userSpaceOnUse"});c[u]=B.genSVGElement("use",l[u]);d[u]=B.genSVGElement("rect",h,{x:"0px",y:"0px"})}B.setStyle(t,{position:"absolute",top:"0px",left:"0px",width:"0px",height:"0px"});return t};if(c.blocks=="svg"){var X=j()}var F=function(t,e,i,s,a,r){this._dir=t;this._isVertical=B.isVertical[t];this._parent=e;this._side=i;this._image=s;this._blockcount=F._svgBlockCounter++;this._svg=null;this._maskRect=null;this._defs=null;this._g=null;this._patterns=null;this._uses=null;this._rects=null;this._setMask();this._createBlocks(a,r)};F._svgBlockCounter=0;F.prototype._setMask=function(){var t="svg-gradient-"+this._blockcount+"-"+i;var e="svg-mask-"+this._blockcount+"-"+i;var s=X.cloneNode(true);var a={north:"y2",east:"x1",south:"y1",west:"x2"};var r=s.childNodes[0];var n=r.childNodes[0];n.setAttribute("id",t);n.setAttribute(a[this._dir],"100%");var o=r.childNodes[1];o.setAttribute("id",e);var h=this._isVertical?"100%":0;var l=this._isVertical?0:"100%";var c=o.childNodes[0];B.setAttributes(c,{width:h,height:l,style:"stroke: none; fill: url(#"+t+")"});var d=s.childNodes[1];d.setAttribute("style","mask:url(#"+e+");");B.setStyle(s,{position:"absolute",top:"0px",left:"0px",width:B.px(h),height:B.px(l)});this._side.appendChild(s);this._svg=s;this._defs=r;this._maskRect=c;this._g=d};F.prototype._createBlocks=function(t,s){var a=this._image.getSide(this._dir);var r="svg-blockset-"+this._blockcount+"-"+i;var n=this._isVertical?a.width:0;var o=this._isVertical?0:a.height;var h=this._isVertical?t:0;var l=this._isVertical?0:s;var c=this._image.getSVGImageId();this._patterns=[];this._uses=[];this._rects=[];var d,u,_;for(var p=0;p<e.blocksNumber;p++){d="pattern-"+p+"-"+r;this._patterns[p]=this._defs.childNodes[p+2];B.setAttributes(this._patterns[p],{id:d,width:B.px(n),height:B.px(o)});u="use-"+p+"-"+r;this._uses[p]=this._patterns[p].childNodes[0];this._uses[p].setAttribute("id",u);this._uses[p].setAttributeNS(B._xlinkNS,"xlink:href","#"+c);_="rect-"+p+"-"+r;this._rects[p]=this._g.childNodes[p];B.setAttributes(this._rects[p],{id:_,width:B.px(h),height:B.px(l),style:"fill: url(#"+d+");"});this._uses[p].setAttribute("transform","matrix(1 0 0 1 0 0)")}};F.prototype.showBlock=function(t){};F.prototype.hideBlock=function(t){var e={};if(B.isVertical[this._dir]){e.height="0px"}else{e.width="0px"}B.setAttributes(this._rects[t],e)};F.prototype.updateIntensity=function(t,e,i){P(this._side,this._dir,t,e,i);var s={};if(this._isVertical){s.height=B.px(t)}else{s.width=B.px(t)}B.setStyle(this._svg,s);B.setAttributes(this._svg,s);B.setAttributes(this._maskRect,s)};F.prototype.updateOffset=function(t,e,i,s){if(this._dir=="south"||this._dir=="west"){e=-e}var a=this._image.getData().sideSize;var r=B.px(e%a);var n={};n[this._isVertical?"x":"y"]=r;B.setAttributes(this._patterns[t],n)};F.prototype.updateParentGeometry=function(t,i){var s={};if(this._isVertical){s.width=B.px(t+2)}else{s.height=B.px(i+2)}B.setStyle(this._side,s);B.setStyle(this._svg,s);B.setAttributes(this._svg,s);for(var a=0;a<e.blocksNumber;a++){B.setAttributes(this._rects[a],s)}};F.prototype.updateBlockGeometry=function(t,e,i,s,a,r){if(this._dir=="south"||this._dir=="east"){e=s-i-e}var n=i/this._image.getData().stretchedSize;var o;if(this._isVertical){o={y:B.px(e),height:B.px(i)}}else{o={x:B.px(e),width:B.px(i)}}B.setAttributes(this._rects[t],o);B.setAttributes(this._patterns[t],o);var h=this._image.getData();var l=this._uses[t].transform.baseVal.getItem(0);var c=0;var d=0;var u=0;switch(this._dir){case"east":c=90;d=h.stretchedSize;break;case"south":c=180;d=h.sideSize;u=h.stretchedSize;break;case"west":c=270;u=h.sideSize;break}var _=1;var p=1;if(this._isVertical){p=n}else{_=n}var f=B.getCommonSVG().createSVGMatrix().scaleNonUniform(_,p).translate(d,u).rotate(c);l.setMatrix(f)};F.prototype.startBlocksUpdate=function(){this._side.style.display="none"};F.prototype.endBlocksUpdate=function(){this._side.style.display="block"};var Y=function(t,e,i,s,a,r){this._dir=t;this._isVertical=B.isVertical[t];this._parent=e;this._side=i;this._image=s;this._canvas=s.getSide("north");this._blocks=[];this._setMask();this._createBlocks()};Y.prototype._setMask=function(){var t={WebkitTransformOrigin:"0 0"};switch(this._dir){case"north":t.top="-1px";t.left="-1px";break;case"east":t.top="-1px";t.left="1px";break;case"south":t.top="1px";t.left="1px";break;case"west":t.top="-1px";t.left="-1px";break}B.setStyle(this._side,t);d.gradientMask(this._side,"north")};Y.prototype._createBlocks=function(){var t=this._image.getSide("north");var i={position:"absolute",width:"100%"};var a,r=[];for(var n=0;n<e.blocksNumber;n++){a=s.div.cloneNode(false);B.setStyle(a,i);d.backgroundCanvas(a,t);this._side.appendChild(a);this._blocks.push(a)}};Y.prototype.showBlock=function(t){this._blocks[t].style.display="block"};Y.prototype.hideBlock=function(t){this._blocks[t].style.display="none"};Y.prototype.updateIntensity=function(t,e,i){this._side.style.height=B.px(t)};Y.prototype.updateOffset=function(t,e,i,s){var a=this._image.getData().sideSize;switch(this._dir){case"north":case"east":e-=1;break;case"south":e+=i-a;e+=1;break;case"west":e+=s-a;e+=1;break}this._blocks[t].style.backgroundPosition=B.px(e)+" 1px"};Y.prototype.updateParentGeometry=function(t,e){var i="";var s="";switch(this._dir){case"north":break;case"east":i="rotate(90deg)";s="translate("+t+"px,0px)";break;case"south":i="rotate(180deg)";s="translate("+t+"px,"+e+"px)";break;case"west":i="rotate(270deg)";s="translate(0px,"+e+"px)";break}var a={width:B.px((this._isVertical?t:e)+2),WebkitTransform:[s,i].join(" ")};B.setStyle(this._side,a)};Y.prototype.updateBlockGeometry=function(t,e,i,s,a,r){var n=this._image.getData().sideSize;var o=2;B.setStyle(this._blocks[t],{top:B.px(e),height:B.px(i+o),backgroundSize:B.px(n)+" "+B.px(i)})};Y.prototype.startBlocksUpdate=function(){};Y.prototype.endBlocksUpdate=function(){};var q;switch(c.blocks){case"svg":q=F;break;case"div":q=H;break;case"webkitTransform":q=Y;break}var J=[];var K=function(){var t;for(var e=0;e<J.length;e++){t=J[e].getElem();if(!d.hasClass(t,"intence")){J[e].destroy();t.intence=null;delete t.intence;J.splice(e,1);e--}}};var Q=function(){var t=document.getElementsByClassName("intence");for(var e=0;e<t.length;e++){if(!t[e].intence){J.push(new O(t[e]));t[e].intence=true}}};var Z=function(){if(l){K();Q()}};if(document.readyState=="complete"){Z()}else{window.addEventListener("load",Z,false)}t.reintence=Z;t.enabled=l});